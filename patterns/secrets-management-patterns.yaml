id: secrets-management-patterns
category: patterns
priority: 10
updated: 2026-02-02

title: Secrets Management & Credential Security
description: |
  Never-commit-secrets rule, per-environment secrets, automated rotation,
  secret scanning in CI/CD, and integration with Vault, AWS Secrets
  Manager, and Kubernetes External Secrets.

rules:
  - action: ALWAYS
    rule: "Store secrets in a dedicated secrets manager (Vault, AWS Secrets Manager, Azure Key Vault) - never in source code or config files"
  - action: ALWAYS
    rule: "Use different secrets for each environment (dev, staging, production) - never share credentials across environments"
  - action: ALWAYS
    rule: "Mask secrets in CI/CD logs - use add-mask directives or masked variables to prevent accidental exposure"
  - action: ALWAYS
    rule: "Run secret scanning (TruffleHog, GitGuardian) as a pre-commit hook and in CI pipeline to catch leaked credentials"
  - action: ALWAYS
    rule: "Encrypt secrets at rest in the secrets manager and in transit via TLS"
  - action: ALWAYS
    rule: "Enable audit logging on all secrets access - who accessed what secret and when"
  - action: NEVER
    rule: "Commit secrets, API keys, or passwords to Git - even in private repos, secrets in history persist after deletion"
  - action: NEVER
    rule: "Pass secrets via environment variables in Dockerfiles (ENV/ARG) - they are visible in docker history and image layers"
  - action: NEVER
    rule: "Use the same database password or API key across dev, staging, and production environments"
  - action: PREFER
    rule: "Rotate secrets automatically on a schedule - use AWS Secrets Manager rotation or Vault dynamic secrets"
  - action: PREFER
    rule: "Use short-lived tokens (STS, dynamic database credentials) over long-lived static credentials"
  - action: PREFER
    rule: "Implement least-privilege access to secrets - each service should only access the secrets it needs"

anti_patterns:
  - "API keys hardcoded as string literals in source code"
  - "Shared database password used in dev, staging, and production"
  - "Secrets stored in .env files committed to Git (even if gitignored, often leaked)"
  - "No secret scanning - leaked credentials discovered only when exploited"
  - "Long-lived static API keys that have never been rotated"
  - "Secrets passed as Docker build ARGs visible in image layer history"
  - "No audit trail - unknown who accessed production credentials"

examples:
  pre_commit_scanning: |
    #!/bin/bash
    # .git/hooks/pre-commit
    docker run --rm -v "$(pwd):/repo" \
      trufflesecurity/trufflehog:latest \
      filesystem --directory=/repo

    if [ $? -ne 0 ]; then
      echo "Secret detected! Commit blocked."
      exit 1
    fi

  vault_github_actions: |
    - name: Import Secrets from Vault
      uses: hashicorp/vault-action@v2
      with:
        url: https://vault.example.com:8200
        token: ${{ secrets.VAULT_TOKEN }}
        secrets: |
          secret/data/database username | DB_USERNAME ;
          secret/data/database password | DB_PASSWORD

  aws_secrets_rotation: |
    # Automated rotation via Lambda
    def rotate_handler(event, context):
        client = boto3.client('secretsmanager')
        new_password = generate_strong_password()
        update_database_password(new_password)
        client.put_secret_value(
            SecretId='my-secret',
            SecretString=json.dumps({'password': new_password})
        )

context: |
  Secrets management is a foundational security control. Leaked credentials are
  the root cause of most breaches. Secrets committed to Git persist in history
  even after deletion - the only fix is credential rotation. Pre-commit hooks
  with TruffleHog or GitGuardian prevent accidental commits. Per-environment
  secrets limit blast radius - a compromised dev credential should not grant
  production access. Short-lived dynamic credentials (Vault dynamic secrets,
  AWS STS) are inherently more secure than static API keys because they expire
  automatically.

related:
  - container-security-patterns
  - api-authentication-security
  - gdpr-data-compliance

tags:
  - secrets
  - credentials
  - vault
  - aws-secrets-manager
  - rotation
  - scanning
  - security
  - ci-cd
